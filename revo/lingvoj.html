<html>
    <head>
        <script>

        var pref_lng = [];

        function HTTPRequest(method, url, params, onSuccess) {
            var request = new XMLHttpRequest();
            var data = new FormData();
          
            for (let [key, value] of Object.entries(params)) {
              data.append(key,value);
            }
          
            request.open(method, url , true);
            
            request.onload = function() {
              if (this.status >= 200 && this.status < 400) {
                onSuccess.call(this,this.response);
              } else {
                // post konektiĝo okazis eraro
                console.error('Eraro dum ŝargo de ' + url);       
              }
            };
            
            request.onerror = function() {
              // konekteraro
              console.error('Eraro dum konektiĝo por ' + url);
            };
            
            //request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            request.send(data);  
          }

          window.onload = function() {
            
            restore_preferences();

            HTTPRequest('GET', "lingvoj.xml", {},
                function() {
                    // Success!
                    var parser = new DOMParser();
                    var doc = parser.parseFromString(this.response,"text/xml");
                    var plist = document.getElementById("pref_lng");
                    var alist = document.getElementById("alia_lng");
                    
                    for (e of doc.getElementsByTagName("lingvo")) {
                        var c = e.attributes["kodo"];
                        //console.log(c);
                        //codes[c.value] = e.textContent;
                        var li = document.createElement("LI");
                        li.appendChild(document.createTextNode(e.textContent));

                        if ( pref_lng.indexOf(c.value) < 0 ) {
                            alist.appendChild(li);
                        } else {
                            plist.appendChild(li);
                        }
                    } 
                });  
          }   


        // memoras valorojn de preferoj en la loka memoro de la retumilo
        function store_preferences() {
            var prefs = {};
            prefs["w:preflng"] = pref_lng;
            window.localStorage.setItem("revo_preferoj",JSON.stringify(prefs));  
        }

        // reprenas memorigitajn valorojn de preferoj el la loka memoro de la retumilo
        function restore_preferences() {
            var str = window.localStorage.getItem("revo_preferoj");            
            var prefs = (str? JSON.parse(str) : null);

            var nav_lng = navigator.languages || [navigator.language];
            pref_lng = (prefs && prefs["w:preflng"])? prefs["w:preflng"] : nav_lng;
        }


        </script>
        <style>
            #pref_lng {
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h3>preferataj tradukoj</h3>
        <div class="pref_lng">
            <label>tradukoj</label>
            <span><input name="o_trd" type="radio" id="trd_preferataj" value="trd_preferataj"><label for="trd_preferataj">preferataj</label></span>
            <span><input name="o_trd" type="radio" id="trd_chiuj" value="trd_chiuj"><label for="trd_chiuj">ĉiuj</label></span>
            <ul id="pref_lng"></ul>
            <ul id="alia_lng"></ul>
        </div>
    </body>
</html>